{"version":3,"file":"sw.min.js","sources":["../_javascript/pwa/sw.js"],"sourcesContent":["import { baseurl } from '../../_config.yml';\n\nimportScripts(`${baseurl}/assets/js/data/swconf.js`);\n\nconst purge = swconf.purge;\nconst interceptor = swconf.interceptor;\n\nfunction verifyUrl(url) {\n  const requestUrl = new URL(url);\n  const requestPath = requestUrl.pathname;\n\n  if (!requestUrl.protocol.startsWith('http')) {\n    return false;\n  }\n\n  for (const prefix of interceptor.urlPrefixes) {\n    if (requestUrl.href.startsWith(prefix)) {\n      return false;\n    }\n  }\n\n  for (const path of interceptor.paths) {\n    if (requestPath.startsWith(path)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nself.addEventListener('install', (event) => {\n  if (purge) {\n    return;\n  }\n\n  event.waitUntil(\n    caches.open(swconf.cacheName).then((cache) => {\n      return cache.addAll(swconf.resources);\n    })\n  );\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((keyList) => {\n      return Promise.all(\n        keyList.map((key) => {\n          if (purge) {\n            return caches.delete(key);\n          } else {\n            if (key !== swconf.cacheName) {\n              return caches.delete(key);\n            }\n          }\n        })\n      );\n    })\n  );\n});\n\nself.addEventListener('message', (event) => {\n  if (event.data === 'SKIP_WAITING') {\n    self.skipWaiting();\n  }\n});\n\nself.addEventListener('fetch', (event) => {\n  if (event.request.headers.has('range')) {\n    return;\n  }\n\n  event.respondWith(\n    caches.match(event.request).then((response) => {\n      if (response) {\n        return response;\n      }\n\n      return fetch(event.request).then((response) => {\n        const url = event.request.url;\n\n        if (purge || event.request.method !== 'GET' || !verifyUrl(url)) {\n          return response;\n        }\n\n        // See: <https://developers.google.com/web/fundamentals/primers/service-workers#cache_and_return_requests>\n        let responseToCache = response.clone();\n\n        caches.open(swconf.cacheName).then((cache) => {\n          cache.put(event.request, responseToCache);\n        });\n        return response;\n      });\n    })\n  );\n});\n"],"names":["importScripts","baseurl","purge","swconf","interceptor","verifyUrl","url","requestUrl","URL","requestPath","pathname","protocol","startsWith","prefix","urlPrefixes","href","path","paths","self","addEventListener","event","waitUntil","caches","open","cacheName","then","cache","addAll","resources","keys","keyList","Promise","all","map","key","delete","data","skipWaiting","request","headers","has","respondWith","match","response","fetch","method","responseToCache","clone","put"],"mappings":"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"}